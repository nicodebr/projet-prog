load("TracesT1.mat") ;

Xr = fillmissing(Xr, 'next'); %remplace les nan par des valeurs%;
Yr = fillmissing(Yr, 'next');
Xy = fillmissing(Xy, 'next');
Yy = fillmissing(Yy, 'next');
Xw = fillmissing(Xw, 'next');
Yw = fillmissing(Yw, 'next');

Yr = 480-Yr;
Yy = 480-Yy;
Yw = 480-Yw;

[Xmin, Xmax, Ymin, Ymax] = GetFrame(Xr, Yr, Xy, Yy, Xw, Yw)

long_cadre = abs(Xmax-Xmin) ;
haut_cadre = abs(Ymax-Ymin) ;

rectangle('position',[Xmin Ymin long_cadre haut_cadre]); 
hold ON; %pour avoir tout sur la meme figure%
plot(Xr, Yr, 'color', 'r', 'marker', '.', 'linestyle', '-');
plot(Xy, Yy, 'color', 'y', 'marker', '.', 'linestyle', '-');
plot(Xw, Yw, 'color', 'b', 'marker', '.', 'linestyle', '-');

% Obtenir la date et l'heure actuelles
now_time = datetime('now');
% Convertir l'objet de date et heure en une chaîne de caractères
time_string = datestr(now_time);
% Créer le titre avec la date et l'heure
titre = sprintf("Scores sheet - nom de la sequence - Date et heure : %s", time_string);
% Ajouter le titre au graphique
title(titre);

%ajouter les étoile pour la position initiale des boules
plot(Xr(1), Yr(1), 'h', 'MarkerSize', 15, 'MarkerEdgeColor', '#800020');
plot(Xy(1), Yy(1), 'h', 'MarkerSize', 15, 'MarkerEdgeColor', 'green');
plot(Xw(1), Yw(1), 'h', 'MarkerSize', 15, 'MarkerEdgeColor', 'blue');

%entourer les rebonds de la première boule taper
Ball_Order_X = {Xr, Xy, Xw};
Ball_Order_Y = {Yr, Yy, Yw};
First_Ball = GetBallMoveOrder(Xr, Yr, Xy, Yy, Xw, Yw, 9)
First_Ball_X = Ball_Order_X{First_Ball};
First_Ball_Y = Ball_Order_Y{First_Ball};
IdxTouch = GetTouchIdx(First_Ball_X,First_Ball_Y, Xmin, Xmax, Ymin, Ymax, 9);
circleSize = 100; % définir la taille du cercle
scatter(First_Ball_X(IdxTouch), First_Ball_Y(IdxTouch), circleSize, 'g', 'LineWidth', 1, 'MarkerFaceColor', 'none', 'MarkerEdgeColor', 'g');

%texte sous le graphique
color = ["red"; "yellow"; "white"];

num_balls = 3; % Remplacer 3 par le nombre de boules approprié
text_str = sprintf('Score sheet for %s          %d ball(s) moved', color(First_Ball,:), num_balls);

% Afficher le texte aligné respectivement à gauche et à droite
txt1 = text(Xmin, Ymin-0.1*(Ymax-Ymin), sprintf('%s', strtrim(text_str(1:end-16))), 'HorizontalAlignment', 'left', 'FontSize', 12);
txt2 = text(Xmax, Ymin-0.1*(Ymax-Ymin), sprintf('%d ball(s) moved', num_balls), 'HorizontalAlignment', 'right', 'FontSize', 12);
uistack(txt1, 'top');
uistack(txt2, 'top');

% Afficher le texte "win" aligné à gauche
txt3 = text(Xmin, Ymax+0.05*(Ymax-Ymin), '---win---', 'HorizontalAlignment', 'left', 'FontSize', 12);

% Afficher le nombre de bandes touchées aligné à droite
num_bands = 2; % Remplacer 2 par le nombre de bandes touchées approprié
txt4 = text(Xmax, Ymax+0.05*(Ymax-Ymin), sprintf('%d band(s) touched', num_bands), 'HorizontalAlignment', 'right', 'FontSize', 12);

% Déplacer les textes en haut de la pile pour qu'ils soient au-dessus de tout le reste
uistack(txt3, 'top');
uistack(txt4, 'top');
